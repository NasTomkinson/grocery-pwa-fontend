---
import './style.scss'
import { Image } from 'astro:assets'
---

<div class="relative flex flex-row justify-center items-center w-screen h-screen"> 
	<div class="relative w-1/2 h-full">
		<Image class="w-full h-full object-cover" src="https://cdn.pixabay.com/photo/2024/09/19/07/30/wild-horse-9057944_1280.jpg" alt="create account" width={900} height={1080}/> 
	</div>

	<div class="relative w-1/2 p-6 flex flex-col justify-center items-center">

		<form id="create-account" class="grid grid-cols-2 auto-cols-auto gap-4 max-w-[128ch]">
			<div class="header col-span-2">
				<h1> Create your account </h1> 
				<p> Create a free account to save shopping lists &amp; access recipes. </p>			
			</div>
	
			<div class="input-container col-span-2">
				<label> What should we call you? </label>
				<input required type="text" name="username" placeholder="JumboPixel98" />
			</div>

			<div class="divider col-span-2" />
			
			<div class="input-container col-span-2">
				<label> Enter your email </label>
				<input required type="email" name="email" placeholder="someone@domain.com" />
			</div>

			<div class="input-container">
				<label> Set a password </label>
				<input required type="password" name="password" placeholder="******" />
			</div>
			
			<div class="input-container">
				<label> Verify password </label>
				<input required type="password" name="password_verify" placeholder="******" />
			</div>

			<button type="submit"> Create account </button>
		</form>		
	</div>
</div>

<script> 

	const form = document.querySelector("#create-account") || null

	form?.addEventListener("submit", (event) => {
		event.preventDefault();

		let formData = new FormData(form);
		let formattedData = {}

		formData.forEach((value, key) => {
			formattedData[key] = value
		})

		if(formattedData?.password == formattedData?.password_verify) {
			createAccount(formattedData)
		} else {
			alert("passwords dont match")
		}
	})

async function createAccount(formData) {
    try {
        const response = await fetch('http://localhost:8000/account/create', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        });

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const result = await response.json();

        console.log(result); 

        return result;
    } catch (error) {
        console.error('Error creating account:', error);
        return null;
    }
}

</script>